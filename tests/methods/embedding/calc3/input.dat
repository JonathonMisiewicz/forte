import forte
sys.path.insert(0, '/mnt/c/Users/Forec/source/')
import ownmp2

def set_wfn_mod(wfn_sys, wfn_mod):
    Ca_sys = wfn_sys.Ca()
    Ca_mod = wfn_mod.Ca()
    Ca_sys.copy(Ca_mod)

    Fa_sys = wfn_sys.Fa()
    Fa_mod = wfn_mod.Fa()
    Fa_sys.copy(Fa_mod)

    Da_sys = wfn_sys.Da()
    Da_mod = wfn_mod.Da()
    Da_sys.copy(Da_mod)

    H_sys = wfn_sys.H()
    H_mod = wfn_mod.H()
    H_sys.copy(H_mod)

    S_sys = wfn_sys.S()
    S_mod = wfn_mod.S()
    S_sys.copy(S_mod)



molecule AB{
     0 1
     O  -3.535769   3.084336  -0.905856
     C  -4.184301   4.243079  -1.205620
     H  -4.722911   4.736433  -0.476563
     H  -4.137341   4.628168  -2.161929
     --
     0 1
     O  -1.551007  -0.114520   0.000000
     H  -1.934259   0.762503   0.000000
     H  -0.599677   0.040712   0.000000
     O   3.350625   0.111469   0.000000
     H   3.680398  -0.373741  -0.758561
     H   3.680398  -0.373741   0.758561

     units angstrom
     no_reorient
     symmetry c1
}

molecule A{
     0 1
     O  -3.535769   3.084336  -0.905856
     C  -4.184301   4.243079  -1.205620
     H  -4.722911   4.736433  -0.476563
     H  -4.137341   4.628168  -2.161929
     units angstrom
     no_reorient
     symmetry c1
}

#****** Calculate environment method ******
activate(AB)
set {
  basis         jun-cc-pvdz
  scf_type      pk
  e_convergence 10
}

E, ori_wfn = energy('scf', return_wfn=True)

# ****** Calculate cheap and expensive system method ******
# ****** Create embedded system wfn ******
set forte {
  job_type Embedding
  SYS_DOCC 8
  LOCALIZATION_METHOD NONE
  SYSTEM_MATRIX ALL
  ORBITAL_SEPARATION P_AB
  C_SIZE ALL
  MATRIX_BASIS IAO_IBO
#  WRITE_TRANS  U
}

E_test, wfn_mod_iao = energy('forte', ref_wfn=ori_wfn, return_wfn=True)
#set cubeprop_tasks ['orbitals', 'density','basis_functions']
#cubeprop(wfn_mod_iao)

# ****** Set modified(embedded) matrices ******
activate(A)

set {
  basis         jun-cc-pvdz
  scf_type      pk
  e_convergence 10
  d_convergence 10
}

E_sys_ref, wfn_sys = energy('scf', return_wfn=True)
set_wfn_mod(wfn_sys, wfn_mod_iao)

set forte {
  job_type           active-dsrgpt2
  cino               false
  frozen_docc        [0]
  restricted_docc    [2]
  active             [12]
  cas_type           cas
  fcimo_actv_type    cisd
  nrootpi            [12]
# print              2
  d_convergence      10
  dsrg_s             0.5
# internal_amp       singles_doubles
}

Eforte, wfn_cas = energy('forte', ref_wfn=wfn_sys, return_wfn=True)

